version: '2.2'

services:
  # Web UI + API mode (current default)
  statuspanel:
    image: trydirect/status:unstable
    container_name: statuspanel
    ports:
     - "5001:5000"
    volumes:
     - .:/app
     - /var/run/docker.sock:/var/run/docker.sock
    # - /data/encrypted:/data/encrypted
    env_file:
      - .env
    environment:
      - NGINX_CONTAINER=nginx
    # Default: serve with UI
    command: ["/usr/local/bin/status", "serve", "--port", "5000", "--with-ui"]

  # Daemon mode with long polling (uncomment to use)
  agent:
    image: trydirect/status:unstable
    container_name: status-agent
    volumes:
     - /var/run/docker.sock:/var/run/docker.sock
    env_file:
      - .env
    environment:
      - DASHBOARD_URL=https://stacker.try.direct
      - DEPLOYMENT_HASH=$DEPLOYMENT_HASH # from .env , deployment identifier
      - POLL_TIMEOUT_SECS=30
      - POLL_BACKOFF_SECS=5
      - POLL_MAX_BACKOFF_SECS=60
    # No subcommand = daemon mode with polling
    command: ["/usr/local/bin/status"]